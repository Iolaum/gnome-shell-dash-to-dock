From 1fddbe64b357ffc29eb13d9b3ab0c4c151d3bfab Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marco=20Trevisan=20=28Trevi=C3=B1o=29?= <mail@3v1n0.net>
Date: Wed, 18 Mar 2020 02:05:22 +0100
Subject: [PATCH 35/36] launcherAPI: Actually keep track of the unity bus ID
 and replace it

Fixes #708
Fixes LP: #1756837
---
 launcherAPI.js | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/launcherAPI.js b/launcherAPI.js
index f0b6199..0f8825c 100644
--- a/launcherAPI.js
+++ b/launcherAPI.js
@@ -78,8 +78,9 @@ var LauncherEntryRemoteModel = class DashToDock_LauncherEntryRemoteModel {
 
     _acquireUnityDBus() {
         if (!this._unity_bus_id) {
-            Gio.DBus.session.own_name('com.canonical.Unity',
-                Gio.BusNameOwnerFlags.ALLOW_REPLACEMENT, null, null);
+            this._unity_bus_id = Gio.DBus.session.own_name('com.canonical.Unity',
+                Gio.BusNameOwnerFlags.ALLOW_REPLACEMENT | Gio.BusNameOwnerFlags.REPLACE,
+                null, () => this._unity_bus_id = 0);
         }
     }
 
-- 
2.25.1

